package org.apache.hupa.client.storage;


import gwtTestSelection.shared.InstrumentationLoggerProvider;
import java.util.List;

import org.apache.hupa.client.rf.FetchMessagesRequest;
import org.apache.hupa.client.rf.HupaRequestFactory;
import org.apache.hupa.shared.algorithms.Md5;
import org.apache.hupa.shared.domain.FetchMessagesAction;
import org.apache.hupa.shared.domain.FetchMessagesResult;
import org.apache.hupa.shared.domain.ImapFolder;
import org.apache.hupa.shared.domain.Settings;
import org.apache.hupa.shared.domain.User;
import org.apache.hupa.shared.events.LoginEvent;
import org.apache.hupa.shared.events.LoginEventHandler;
import org.apache.hupa.shared.storage.AppCache;

import com.google.gwt.core.client.Scheduler;
import com.google.gwt.core.client.Scheduler.RepeatingCommand;
import com.google.gwt.event.shared.EventBus;
import com.google.gwt.event.shared.HandlerRegistration;
import com.google.gwt.query.client.Function;
import com.google.gwt.query.client.GQuery;
import com.google.gwt.query.client.Promise;
import com.google.gwt.query.client.plugins.deferred.PromiseFunction;
import com.google.inject.Inject;
import com.google.inject.Singleton;
import com.google.web.bindery.requestfactory.shared.gquery.PromiseRF;

/**
 * Methods to cache/store Hupa stuff.
 * @author manolo
 */
@Singleton
public class HupaStorage {

    static {
	  InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926e637b7bc_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926e637b7bc0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926e637b7bc0x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926e637b7bc0x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926e637b7bc0x1");
	  InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f859264d8fb9d00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859264d8fb9d0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859264d8fb9d00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859264d8fb9d00x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859264d8fb9d00x3");
	  InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b38ae4d50x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b38ae4d50x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b38ae4d50x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b38ae4d5_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b38ae4d50x2");
	}
	
	@Inject protected AppCache cache;
    @Inject protected HupaRequestFactory rf;

    protected static String KEY_CACHE_FOLDERS = "fld";
    protected static String KEY_CACHE_SERVER = "srv";
    protected static String KEY_CACHE_MSGS = "msg";

    protected User user;

    private Promise loginPromise;
    private HandlerRegistration onLogin;

    public static class FunctionPromise extends Function{
        private Promise p;
        public FunctionPromise(Promise promise) {
            InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce0x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce0x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce0x0");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce516b9783_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce516b97830x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce516b97830x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce516b97830x0");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ceb979265c_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ceb979265c0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ceb979265c0x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ceb979265c0x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ceb979265c0x2");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926f98f14310x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926f98f14310x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926f98f14310x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926f98f1431");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926570686270x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592657068627_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926570686270x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926570686270x1");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592612dea96f0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592612dea96f_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592612dea96f0x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592612dea96f0x1");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592622ee00970x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592622ee00970x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592622ee0097_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592622ee00970x2");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b03592800x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b03592800x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b0359280_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b03592800x0");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ceb979265c0x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ceb979265c0x20x00x0");
			p = promise;
        }
        public Object f(Object... args) {
            InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce305bef470x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce305bef470x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce305bef470x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce305bef470x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce305bef470x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce305bef47");
			InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce305bef470x30x0");
			return p;
        }
    }

    @Inject
    public HupaStorage(EventBus eventBus) {
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x0");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce0x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce0x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce0x0");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce516b9783_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce516b97830x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce516b97830x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610b4d9ce516b97830x0");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926f98f14310x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926f98f14310x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926f98f14310x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926f98f1431");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926570686270x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592657068627_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926570686270x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926570686270x1");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592612dea96f0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592612dea96f_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592612dea96f0x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592612dea96f0x1");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592622ee00970x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592622ee00970x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592622ee0097_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592622ee00970x2");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b03592800x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b03592800x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b0359280_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926b03592800x0");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x0");
		onLogin = eventBus.addHandler(LoginEvent.TYPE, new LoginEventHandler() {
            public void onLogin(LoginEvent event) {
                InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x20x0");
				InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x30x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x30x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x30x0");
				user = event.getUser();
                InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x30x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926af91009a0x20x00x00x00x00x15db5302f0x30x1");
				onLogin.removeHandler();
            }
        });
    }

    public Function waitingForLogin() {
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe30_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x0");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x1");
		return new Function() {
            public Object f(Object... data) {
                InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af95763_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x1");
				if (loginPromise == null) {
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x0");
					InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x0");
					loginPromise = new PromiseFunction() {
                        public void f(final Deferred dfd) {
                            InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x20x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x136610873_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x0");
							InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x0");
							Scheduler.get().scheduleIncremental(new RepeatingCommand() {
                                public boolean execute() {
                                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x2");
									InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x1");
									if (user != null) {
                                        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x00x10x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x00x10x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x00x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x00x10x0");
										String uk = Md5.md5Hex(user.getName()).substring(0, 8) + "_";
                                        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x1");
										cache.setPrefix(uk);
                                        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x20x0");
										dfd.resolve(user);
                                        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x00x10x3");
										return false;
                                    }
                                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x00x10x00x00x00x1366108730x30x00x00x10x139ae89e00x20x1");
									return true;
                                }
                            });
                        }
                    };
                }
                InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926185bfe300x20x00x00x12af957630x30x1");
				return loginPromise;
            }
        };
    }

    public Promise gettingFolders() {
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592645c90709_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592645c907090x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592645c907090x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592645c907090x2");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592645c907090x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592645c907090x20x00x0");
		return gettingFolders(false);
    }

    public Promise gettingFolders(final boolean skipCache) {
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d33419_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x20x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x20x0");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x0");
		return GQuery
        .when(waitingForLogin())
        .then(new Function() {
            public Object f(Object... args) {
                InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef47_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x1");
				InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x00x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0");
				List<ImapFolder> t = skipCache ? null: cache.restoreProxies(ImapFolder.class, KEY_CACHE_FOLDERS);
                if (t != null && !t.isEmpty()) {
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x1");
					InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x10x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x10x00x00x0");
					return GQuery.Deferred().resolve(t).promise();
                } else {
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x2");
					InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x00x10x0");
					return new PromiseRF(rf.fetchFoldersRequest().fetch(null, Boolean.TRUE))
                    .done(new Function(){public void f() {
                        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a1921_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x1");
						InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x10x0");
						List<ImapFolder> folderNodes = arguments(0);
                        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592610d334190x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x10x0");
						cache.storeProxies(KEY_CACHE_FOLDERS, folderNodes);
                    }});
                }
            }
        });
    }

    public Promise gettingMessages(final boolean skipCache, final String folderFullName, final int start, final int offset, final String search) {
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x20x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x6_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x40x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x40x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a49_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x50x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x50x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x60x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x7_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x30x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x30x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x60x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x5_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x4");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x0");
		return GQuery
        .when(waitingForLogin())
        .then(new Function() {
            public Object f(Object... args) {
                InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef47_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x1");
				InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x00x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x00x00x0");
				List<ImapFolder> t = skipCache ? null: cache.restoreProxies(ImapFolder.class, KEY_CACHE_MSGS);
                InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x00x10x0");
				if (t != null && !t.isEmpty()) {
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x10x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x10x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x10x0");
					return GQuery.Deferred().resolve(t).promise();
                } else {
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x2");
					InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x00x10x0");
					FetchMessagesRequest req = rf.messagesRequest();
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x10x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x10x10x0");
					FetchMessagesAction action = req.create(FetchMessagesAction.class);
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x20x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x20x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x20x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x20x0");
					final ImapFolder f = req.create(ImapFolder.class);
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x30x0");
					f.setFullName(folderFullName);
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x4_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x40x0");
					action.setFolder(f);
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x50x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x5");
					action.setOffset(offset);
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x6_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x60x0");
					action.setSearchString(search);
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x70x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x7");
					action.setStart(start);
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x8_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x00x1");
					return new PromiseRF(req.fetch(action))
                    .done(new Function(){public void f() {
                        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x14a0a19210x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x14a0a1921_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x14a0a19210x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x14a0a19210x0");
						InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x14a0a19210x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x14a0a19210x20x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x14a0a19210x20x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592629345a490x70x00x00x10x1305bef470x30x10x20x80x00x10x14a0a19210x20x00x0");
						FetchMessagesResult result = arguments(0);
                        // cache.storeProxies(KEY_CACHE_FOLDERS, folderNodes);
                    }});
                }
            }
        });
    }

    public Promise gettingSettings(final boolean skipCache) {
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x20x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592614125432_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x20x0");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x0");
		return GQuery
        .when(waitingForLogin())
        .then(new Function() {
            public Object f(Object... args) {
                InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef47_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x2");
				InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x00x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x00x1");
				List<ImapFolder> t = skipCache ? null: cache.restoreProxies(ImapFolder.class, KEY_CACHE_FOLDERS);
                InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x00x10x0");
				if (t != null && !t.isEmpty()) {
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x10x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x10x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x10x00x00x00x0");
					return GQuery.Deferred().resolve(t).promise();
                } else {
                    InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x2");
					InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x00x10x0");
					return new PromiseRF(rf.fetchFoldersRequest().fetch(null, Boolean.TRUE))
                    .done(new Function(){public void f() {
                        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a1921_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x0");
						InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x00x0");
						List<ImapFolder> folderNodes = arguments(0);
                        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926141254320x30x00x00x10x1305bef470x30x10x20x00x00x10x14a0a19210x20x1");
						cache.storeProxies(KEY_CACHE_FOLDERS, folderNodes);
                    }});
                }
            }
        });
    }

    public void expireFolders() {
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926193ab5210x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926193ab5210x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926193ab5210x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926193ab521");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926193ab5210x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926193ab5210x20x00x0");
		cache.setExpires(KEY_CACHE_FOLDERS, 0);
    }

    public Settings getSettingsByEmail(String email) {
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef480_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x3");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x30x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x30x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x30x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x30x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x30x00x00x00x00x0");
		cache.setPrefix(Md5.md5Hex(email).substring(0, 8) + "_");
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x30x10x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f859262f0ef4800x30x1");
		return cache.restoreProxy(Settings.class, KEY_CACHE_SERVER, false);
    }

    public void saveSettings(String email, Settings settings) {
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x20x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x2_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x4_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x3_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x30x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f8592669650365");
		InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x40x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x40x00x00x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x40x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x40x00x00x0_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x40x00x00x00x0");
		cache.setPrefix(Md5.md5Hex(email).substring(0, 8) + "_");
        InstrumentationLoggerProvider.get().instrument("org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x40x1_____org_apache_hupa_client_storage_HupaStorage_java0x0e7f85926696503650x40x10x0");
		cache.storeProxy(settings, KEY_CACHE_SERVER);
    }
}
